{
    "Dockerfile": "# Arguments\nARG DEBIAN_VERSION=12\nARG DISTROLESS_VERSION=nonroot\n\n### LOADER IMAGE ###\nFROM debian:${DEBIAN_VERSION} as loader\nWORKDIR /loader\n\n# Update and install required base software\n# hadolint ignore=DL3008\nRUN apt-get update && apt-get upgrade -y \\\n    && apt-get install --no-install-recommends -y build-essential dumb-init wget tzdata ca-certificates \\\n    && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# Get the latest updates for pre-installed packages\n# to deal with potential CVEs\n# hadolint ignore=DL3009\nRUN apt-get update && apt-get upgrade -y && apt-get clean && rm -rf /var/lib/apt/lists/*\n\n# User setup\nENV APP_USER_NAME=app\nENV APP_USER_ID=2323\nENV APP_USER_HOME=/app\n\n# Create app user/group/home\nRUN groupadd -g ${APP_USER_ID} ${APP_USER_NAME} \\\n    && useradd -l -m -d ${APP_USER_HOME} -u ${APP_USER_ID} -g ${APP_USER_NAME} ${APP_USER_NAME} \\\n    && cp /etc/group /loader/group && cp /etc/passwd /loader/passwd \n\n# Remove unnecessary accounts, excluding current app user and root\nRUN sed -i -r \"/^($APP_USER_NAME|root|nobody)/!d\" /loader/group \\\n    && sed -i -r \\\"/^($APP_USER_NAME|root|nobody)/!d\\\" /loader/passwd \n\n# TLS/SSL for AWS RDS\nRUN wget --quiet https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem -O /etc/ssl/certs/aws-rds.crt \\\n    && cat /etc/ssl/certs/aws-rds.crt >> /etc/ssl/certs/ca-certificates.crt\n\n# Health Check Tool\nCOPY --from=ghcr.io/fivexl/lprobe:0.0.8 /lprobe lprobe\n\nUSER app\nRUN mkdir -m 0700 /tmp/tmp\n\n### RUN IMAGE ###\nFROM gcr.io/distroless/python3-debian11:${DISTROLESS_VERSION}\n\n# Copy necessary files from loader\nCOPY --from=loader /loader/group /etc/group \nCOPY --from=loader /loader/passwd /etc/passwd \nCOPY --from=loader /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt\nCOPY --from=loader /etc/os-release /etc/os-release\nCOPY --from=loader /loader/lprobe /usr/bin/lprobe\nCOPY --from=loader --chown=app:app --chmod=0700 /tmp/tmp /app/tmp\n\n# Set ENV\nENV PATH=\\\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\\\"\nENV TMPDIR=\\\"/app/tmp/\\\"\nENV SSL_CERT_FILE=\\\"/etc/ssl/certs/ca-certificates.crt\\\"\n\nHEALTHCHECK --interval=1m --timeout=3s \\\n    CMD [\\\"lprobe\\\", \\\"-mode=http\\\", \\\"-endpoint=/\\\", \\\"-port=80\\\"]\n\nUSER app\nWORKDIR /app"
}